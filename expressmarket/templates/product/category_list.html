{% extends "base.html" %}
{% load static %}
{% block title %}Categories | ExpressMarket{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4">
    <h1 class="text-3xl font-bold text-gray-900">Product Categories</h1>
    {% if is_vendor %}
    <a href="{% url 'product:category_create' %}" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition whitespace-nowrap inline-block text-center">
      + Create Category
    </a>
    {% endif %}
  </div>

  {% if categories %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for category in categories %}
        <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
          <h3 class="font-semibold text-lg mb-2 text-gray-900">{{ category.name }}</h3>
          {% if category.description %}
            <p class="text-sm text-gray-600 mb-4">{{ category.description|truncatewords:20 }}</p>
          {% else %}
            <p class="text-sm text-gray-400 italic mb-4">No description</p>
          {% endif %}
          <div class="text-xs text-gray-500 mb-4">
            Created: {{ category.created_at|date:"M d, Y" }}
          </div>
          {% if is_vendor %}
          <div class="flex gap-2">
            <a href="{% url 'product:category_edit' category.pk %}" class="flex-1 text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition text-sm">
              Edit
            </a>
            <form method="post" action="{% url 'product:category_delete' category.pk %}" class="flex-1" onsubmit="return confirm('Are you sure you want to delete this category? This action cannot be undone.');">
              {% csrf_token %}
              <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition text-sm">
                Delete
              </button>
            </form>
          </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if categories.has_other_pages %}
      <div class="mt-6 flex justify-center">
        <nav class="flex gap-2">
          {% if categories.has_previous %}
            <a href="?page={{ categories.previous_page_number }}" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
              Previous
            </a>
          {% endif %}
          
          {% for num in categories.paginator.page_range %}
            {% if categories.number == num %}
              <span class="px-4 py-2 bg-blue-600 text-white rounded-lg">{{ num }}</span>
            {% elif num > categories.number|add:'-3' and num < categories.number|add:'3' %}
              <a href="?page={{ num }}" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                {{ num }}
              </a>
            {% endif %}
          {% endfor %}
          
          {% if categories.has_next %}
            <a href="?page={{ categories.next_page_number }}" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
              Next
            </a>
          {% endif %}
        </nav>
      </div>
    {% endif %}
  {% else %}
    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
      <p class="text-gray-600 mb-4">No categories found.</p>
      {% if is_vendor %}
      <a href="{% url 'product:category_create' %}" class="inline-block bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition">
        Create First Category
      </a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}

