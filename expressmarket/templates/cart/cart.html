{% extends "base.html" %}
{% load static %}
{% block title %}Shopping Cart | ExpressMarket{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">Shopping Cart</h1>
  
  {% if cart_items %}
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Cart Items -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
          <div class="divide-y divide-gray-200">
            {% for item in cart_items %}
              <div class="p-6 flex flex-col sm:flex-row gap-4">
                <!-- Product Image -->
                <div class="flex-shrink-0">
                  <a href="{% url 'product:product_detail' item.product.slug %}">
                    {% if item.product.image %}
                      <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" 
                           class="w-24 h-24 object-cover rounded-lg">
                    {% else %}
                      <div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                        No Image
                      </div>
                    {% endif %}
                  </a>
                </div>
                
                <!-- Product Info -->
                <div class="flex-grow">
                  <h3 class="text-lg font-semibold text-gray-900 mb-2">
                    <a href="{% url 'product:product_detail' item.product.slug %}" class="hover:text-blue-600">
                      {{ item.product.name }}
                    </a>
                  </h3>
                  
                  {% if item.product.vendor %}
                    <p class="text-sm text-gray-600 mb-2">
                      Sold by: 
                      {% if item.product.vendor.business_name %}
                        {{ item.product.vendor.business_name }}
                      {% else %}
                        {{ item.product.vendor.user.username }}
                      {% endif %}
                    </p>
                  {% endif %}
                  
                  <p class="text-lg font-bold text-blue-700">${{ item.product.price }}</p>
                </div>
                
                <!-- Quantity and Actions -->
                <div class="flex flex-col items-end justify-between">
                  <div class="flex items-center gap-2 mb-4">
                    <form method="post" action="{% url 'core_ecommerce:update_cart' item.product.id %}" class="flex items-center gap-2">
                      {% csrf_token %}
                      <label for="quantity_{{ item.product.id }}" class="text-sm text-gray-600">Qty:</label>
                      <input type="number" 
                             name="quantity" 
                             id="quantity_{{ item.product.id }}"
                             value="{{ item.quantity }}" 
                             min="1" 
                             class="w-16 px-2 py-1 border border-gray-300 rounded text-center"
                             onchange="this.form.submit()">
                    </form>
                  </div>
                  
                  <div class="text-right">
                    <p class="text-lg font-bold text-gray-900 mb-2">${{ item.item_total }}</p>
                    <form method="post" action="{% url 'core_ecommerce:remove_from_cart' item.product.id %}" class="inline">
                      {% csrf_token %}
                      <button type="submit" class="text-red-600 hover:text-red-800 text-sm">
                        Remove
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        
        <!-- Clear Cart Button -->
        <div class="mt-4">
          <form method="post" action="{% url 'core_ecommerce:clear_cart' %}" onsubmit="return confirm('Are you sure you want to clear your cart?');">
            {% csrf_token %}
            <button type="submit" class="text-red-600 hover:text-red-800 text-sm">
              Clear Cart
            </button>
          </form>
        </div>
      </div>
      
      <!-- Order Summary -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-lg p-6 sticky top-4">
          <h2 class="text-xl font-bold text-gray-900 mb-4">Order Summary</h2>
          
          <div class="space-y-3 mb-6">
            <div class="flex justify-between text-gray-600">
              <span>Subtotal ({{ cart_count }} item{{ cart_count|pluralize }}):</span>
              <span class="font-semibold">${{ total }}</span>
            </div>
            <div class="flex justify-between text-gray-600">
              <span>Shipping:</span>
              <span class="font-semibold">Calculated at checkout</span>
            </div>
            <div class="border-t border-gray-200 pt-3">
              <div class="flex justify-between text-xl font-bold text-gray-900">
                <span>Total:</span>
                <span>${{ total }}</span>
              </div>
            </div>
          </div>
          
          <a href="{% url 'core_ecommerce:home' %}" 
             class="block w-full text-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg transition duration-200 mb-3">
            Continue Shopping
          </a>
          
          {% if user.is_authenticated %}
            <a href="{% url 'core_ecommerce:checkout' %}" 
               class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
              Proceed to Checkout
            </a>
          {% else %}
            <a href="{% url 'accounts:login' %}?next={% url 'core_ecommerce:checkout' %}" 
               class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
              Login to Checkout
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  {% else %}
    <!-- Empty Cart -->
    <div class="bg-white rounded-lg shadow-lg p-12 text-center">
      <svg class="mx-auto h-24 w-24 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
      </svg>
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Your cart is empty</h2>
      <p class="text-gray-600 mb-6">Start shopping to add items to your cart.</p>
      <a href="{% url 'core_ecommerce:home' %}" 
         class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
        Continue Shopping
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}

